@section css{
    <link href="~/Scripts/layer/skin/layer.css" rel="stylesheet" />
    @*<link href="~/Content/datatables/jquery.dataTables.min.css" rel="stylesheet" />*@
    <link href="~/Content/leonstyle.css" rel="stylesheet" />
    <link href="~/static/bootstrap-select/css/bootstrap-select.css" rel="stylesheet" />
    <link href="~/Content/bootstrap-fileinput/css/fileinput.min.css" rel="stylesheet" />
    <link href="~/static/bootstarp_table/css/bootstrap-table.css" rel="stylesheet" />
    <link href="~/static/bootstarp_table/extensions/page-jump-to/bootstrap-table-page-jump-to.css" rel="stylesheet" />
    <link href="~/static/bootstarp_table/extensions/fixed-columns/bootstrap-table-fixed-columns.css" rel="stylesheet" />
    <style type="text/css">
        /*Google滚动条样式 改为透明色*/
        ::-webkit-scrollbar {
            width: 6px;
            height: auto;
            position: absolute;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #3c8dbc;
            /*background-color: #5bc0de;*/
        }

        ::-webkit-scrollbar-track {
            background-color: #ddd;
        }

        /*去除bootstrap 按钮边角料颜色*/
        select.input-sm {
            padding-left: 6px;
        }

        .modal-title {
            font-weight: bold;
        }

        .btn:focus {
            outline: none;
        }

        .btn-warning:focus {
            border-color: #ec971f;
        }

        /*dataList显示下拉图标*/
        input::-webkit-calendar-picker-indicator {
            opacity: 100;
        }
        /*F6F6F6*/


        /* Image style 回到顶部 */
        #scrollUp {
            background-image: url('../../static/adminLTE/plugins/scrollup/demo/img/top.png');
            bottom: 50px;
            right: 20px;
            width: 38px; /* Width of image */
            height: 38px; /* Height of image */
        }


        .MyClass {
            text-overflow: ellipsis; /* 一行显示*/
            white-space: nowrap; /* 不换行 */
            overflow: hidden; /* 内容超出宽度时隐藏超出部分的内容 */
        }

        .myTable {
            table-layout: fixed; /*不添加此样式，会全部显示    */
        }

        td {
            word-break: break-all;
            word-wrap: break-word;
        }

        .LStyle {
            color: white;
        }
    </style>
}
@section js{
    <script src="~/Scripts/layer/layer.js"></script>
    <script src="~/Scripts/leon/leonhelper.js"></script>
    <script src="~/Scripts/datatables/jquery.dataTables.min.js"></script>
    <script src="~/static/bootstrap-select/js/bootstrap-select.js"></script>
    <script src="~/Content/bootstrap-fileinput/js/fileinput.min.js"></script>
    <script src="~/static/bootstrap-select/js/i18n/defaults-zh_CN.js"></script>
    <script src="~/Content/bootstrap-fileinput/js/locales/zh.js"></script>
    <script src="~/static/bootstarp_table/js/bootstrap-table.js"></script>
    <script src="~/static/bootstarp_table/js/bootstrap-table-zh-CN.js"></script>
    <!-- 跳转页 -->
    <script src="~/static/bootstarp_table/extensions/page-jump-to/bootstrap-table-page-jump-to.js"></script>
    <!-- 固定列 -->
    <script src="~/static/bootstarp_table/extensions/fixed-columns/bootstrap-table-fixed-columns.js"></script>
    <script>


        $.scrollUp({
            scrollName: 'scrollUp',
            topDistance: '300', // Distance from top before showing element (px) 元素显示前与顶部的距离(px)
            topSpeed: 500, // Speed back to top (ms)  快速返回顶部(ms)
            animation: 'slide',// Fade, slide, none  按钮展示动画：褪色,幻灯片,没有
            animationInSpeed: 200, // Animation in speed (ms)   速度动画(ms)
            animationOutSpeed: 200, // Animation out speed (ms)  动画输出速度(ms)
            activeOverlay: false,
            scrollImg: {
                active: true,
                type: 'background',
                src: 'img/top.png'
            }, zIndex: 5000
        });

        $("#input-1a").fileinput({
            language: "zh",
            showPreview: true,
            showCancel: false,
            showUpload: false, //是否显示上传按钮
            //browseClass: "btn btn-info", //按钮样式
            //previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
        });




        $(function () {

            InitMainTable();


            InitLogTime();
            //$('#divModal').modal('show');

            //初始化加载物料信息
            InitMaterialDDL();

            //保存
            $("#btnSave").click(function () {

                //获取保存时页码
                var pageIndex = $('#tbMainList').bootstrapTable('getOptions').pageNumber;

                var hidwlID = $("#hidwlID").val();
                if (hidwlID == "") {
                    leonhelper.simpleAlert("请选择物料", 0);
                    $("#txtWlName").focus();
                    return;
                }

                var qty = $("#txtqty").val();
                if (qty == "") {
                    leonhelper.simpleAlert("请输入数量", 2);
                    $("#txtqty").focus();
                    return;
                }

                leonhelper.loading();
                leonhelper.callByAjax("/Material/SaveInventory", {
                    ID: $("#hidID").val(),
                    wlID: $("#hidwlID").val(),
                    batch: $("#txtbatch").val().trim(),
                    unit: $("#txtunit").val().trim(),
                    projectNo: $("#txtprojectNo").val().trim(),
                    qty: $("#txtqty").val(),
                    lockQty: $("#txtlockQty").val(),
                    InvOrgID: $("#SelInvOrg").val(),
                    inventoryTypeID: $("#SelinventoryTypeID").val(),
                    warehouseID: $("#Selwarehouse").val(),
                    remark: $("#txtremark").val()
                }, function (data) {
                    if (data.Result) {
                        leonhelper.simpleAlert(data.Message, 1, function () {
                            $('#tbMainList').bootstrapTable('refresh', { PageIndex: pageIndex });
                            $('#divModal').modal('hide');
                        });
                    } else {
                        leonhelper.simpleAlert(data.Message, 2);
                    }
                });
            });

            //新增按钮点击事件
            $("#btnAdd").click(function () {
                $("#hTit").html("新增库存信息");
                //清空数据
                $("#hidID").val("0");
                $("#txtWlName").val("");
                $("#hidwlID").val("");
                $("#txtbatch").val("");
                $("#txtunit").val("PC");
                $("#txtprojectNo").val("");
                $("#txtqty").val("");
                $("#txtlockQty").val("");
                $("#SelInvOrg").val(1);
                $("#SelinventoryType").val(1);
                $("#Selwarehouse").val(1);
                $("#txtremark").val("");
            });




            //备料物料change事件
            $("#txtWlName").change(function () {
                $("#hidwlID").val("");//清空隐藏域
                //当前datalist上input的文本值
                var input_select = $("#txtWlName").val();
                var option_length = $(".materialItem").length;
                var option_id = '';
                for (var i = 0; i < option_length; i++) {
                    var option_value = $(".materialItem").eq(i).val();
                    if (input_select == option_value) {
                        option_id = $(".materialItem").eq(i).attr('data-id');
                        break;
                    }
                }
                $("#hidwlID").val(option_id);
            });

        });





        var $table;
        //初始化bootstrap-table的内容
        function InitMainTable() {
            //记录页面bootstrap-table全局变量$table，方便应用
            var queryUrl = '/Material/Inventorys';
            //$('#tbMainList').bootstrapTable('hideLoading');
            $('#tbMainList').bootstrapTable({
                url: queryUrl,                      //请求后台的URL（*）

                theadClasses: "thead-blue",//这里设置表头样式
                paginationFirstText: "首页",
                paginationPreText: "上一页",
                paginationNextText: "下一页",
                paginationLastText: "末页",
                method: 'GET',                      //请求方式（*）
                //toolbar: '#toolbar',               //工具按钮用哪个容器
                paginationVAlign: 'bottom',               //指示如何垂直对齐分页。'top', 'bottom', 'both'（穿上顶部和底部的分页）都可以使用。
                paginationSuccessivelySize: 5,          //连续的最大连续页数。
                paginationPagesBySide: 2,                //当前页面每侧（右侧，左侧）的页数。
                //searchOnEnterKey: true,              //按回车时触发搜索功能
                striped: true,                      //是否显示行间隔色,是否显示斑马线效果
                showLoading: false,
                cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                pagination: true,                   //是否显示分页（*）
                sortable: true,                     //是否启用排序
                sortOrder: "asc",                   //排序方式
                sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                pageNumber: 1,                      //初始化加载第一页，默认第一页,并记录
                pageSize: 10,                       //每页的记录行数（*）
                pageList: [10, 50, 100, 500],     //可供选择的每页的行数（*）
                search: false,                      //是否显示表格搜索,此搜索是客户端搜索,不进服务端
                //strictSearch: true,                //
                //showColumns: true,                 //是否显示所有的列（选择显示的列）
                //showRefresh: true,                  //是否显示刷新按钮
                //minimumCountColumns: 2,             //最少允许的列数
                //clickToSelect: true,                //是否启用点击选中行
                //height: 580,                      //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
                uniqueId: "ID",                     //每一行的唯一标识，一般为主键列
                //showToggle: true,                   //是否显示详细视图和列表视图的切换按钮
                //cardView: false,                    //是否显示卡片式视图
                //detailView: false,                  //是否显示父子表
                locale: 'zh-CN',                    //中文支持
                singleSelect: false,                //设置True 将禁止多选
                reorderableRows: false,              //设置拖动排序
                useRowAttrFunc: false,               //设置拖动排序
                paginationLoop: false,              //设置为 true 启用分页条无限循环的功能。
                showJumpTo: true,                   //是否显示跳页
                fixedColumns: true,                 //启用固定列
                fixedNumber: 1,                     //固定列数
                //得到查询的参数
                queryParams: function (params) {
                    //这里的键的名字和控制器的变量名必须一致，这边改动，控制器也需要改成一样的
                    var temp = {
                        pageSize: params.limit,                                 //每页显示[10,20,30,40]数量
                        PageIndex: params.offset,                               //页码数量 第一页0、第二页10，第三页20以此类推
                        sort: 'pp_sort',                                        //排序列名
                        sortOrder: params.order,                                //排位命令（desc，asc）
                        //wlID: $("#BMMC_SELECT").val(),
                        wlName: $('#wlName').val(),
                        wlCode: $('#wlCode').val(),
                        wlModel: $('#wlModel').val(),
                        //warehouseID: $('#LIKEWlName').val(),
                        inventoryTypeID: $('#inventoryTypeID').val(),
                        isExists: $('#isExists').val()
                    };
                    return temp;
                },
                columns: [{
                    checkbox: true,
                    visible: true                  //是否显示复选框
                }, {
                    field: 'wlCode',
                    title: '物料编号'
                }, {
                    field: 'wlName',
                    title: '物料名称'
                }, {
                    field: 'wlModel',
                    title: '规格型号',
                    align: 'center'
                    //,
                    //   cellStyle: function (value, row, index, field) {
                    //       return {
                    //           classes: 'text-nowrap another-class',
                    //           css: {
                    //               "color": "red",
                    //               "font-size": "15px",
                    //           }
                    //       }
                    //   }
                }, {
                    field: 'batch',
                    title: '批次',
                    align: 'center'
                }, {
                    field: 'projectNo',
                    title: '项目号'
                }, {
                    field: 'unit',
                    title: '计量单位',
                    align: 'center',
                    width: 80,
                }, {
                    field: 'qty',
                    title: '数量',
                    align: 'center',
                    width: 80,
                },
                //{
                //    field: 'lockqty',
                //    title: '锁库数量'
                //},
                 {
                     field: 'InvOrgText',
                     title: '库存组织'
                 }, {
                     field: 'inventoryTypeText',
                     title: '库存类型'
                 }, {
                     field: 'warehouseText',
                     title: '仓库'
                 }, {
                     field: 'isExistsText',
                     title: '校验',
                     align: 'center',
                     width: 70,
                     formatter: ExistsFormatter
                 }, {
                     field: 'remark',
                     title: '备注',
                     formatter: paramsMatter,
                     cellStyle: function (value, row, index) {
                         return {
                             classes: "MyClass"
                         }
                     }
                 }, {
                     field: 'ID',
                     title: '操作',
                     align: 'center',
                     width: 85,
                     valign: 'middle',
                     formatter: actionFormatter
                 }],
                //rowStyle: function (row, index) {
                //    if (row["isExists"] == 1) {
                //        return {
                //            css: { "background-color": "#f2dede" }
                //        }
                //    }
                //    return {};
                //},
                onLoadSuccess: function (data) {

                },
                onLoadError: function () {
                }
            });


            $("#tbMainList").bootstrapTable("hideLoading");
        }


        function ExistsFormatter(value, row, index) {
            var html = "";
            if (row["isExists"] == 0) {
                //存在
                html = "<span class='badge LStyle' style='background-color:#68af35;font-size:13px;'>" + value + "</span>";
            } else {
                //不存在
                html = "<span class='badge LStyle' style='background-color:#dd4b39;font-size:13px;'>" + value + "</span>";
            }
            return html;
        }


        //备注添加 tooltip浮动title
        function paramsMatter(value, row, index) {
            if (isDeNull(value)) {
                return "<span onmouseover='mouseoverText(this);'>" + value + "</span>";
            } else {
                return "";
            }
        }

        //操作
        function actionFormatter(value, row, index) {
            var htm = "<a class='btn btn-primary btn-sm' data-toggle='modal' data-target='#divModal' href='#' onclick=\"EditData(\'" + row["ID"] + "\',\'" + row["wlID"] + "\',\'" + row["wlCode"] + "\',\'" + row["batch"] + "\',\'" + row["unit"] + "\',\'" + row["projectNo"] + "\',\'" + row["qty"] + "\',\'" + row["lockqty"] + "\',\'" + row["InvOrgID"] + "\',\'" + row["inventoryTypeID"] + "\',\'" + row["warehouseID"] + "\',\'" + row["remark"] + "\')\" ><i class='fa fa-edit'></i>编辑</a> "
            return htm;
        }

        //查询刷新
        $("#BtnQuery").click(function () {
            $('#tbMainList').bootstrapTable('refresh');
            //$('#tbMainList').bootstrapTable('refreshOptions', { pageNumber: 1, pageSize: 10 });//便可以了
            //var curAgentTablePageNumber = $("#agentTable").bootstrapTable("getOptions").pageNumber;获取当前页面
        });

        //回车绑定
        document.onkeydown = function () {
            if ((window.event.keyCode || window.event.which) == 13) {
                $('#tbMainList').bootstrapTable('refresh');
            }
        }

        //编辑
        function EditData(ID, wlID, wlCode, batch, unit, projectNo, qty, lockqty, InvOrgID, inventoryTypeID, warehouseID, remark) {
            $("#hTit").html("编辑库存信息");

            //赋值
            $("#hidID").val(ID);
            $("#txtWlName").val(isDeNull(wlCode) ? wlCode : "");
            $("#hidwlID").val(isDeNull(wlID) ? wlID : "");
            $("#txtbatch").val(isDeNull(batch) ? batch : "");
            $("#txtunit").val(unit);
            $("#txtprojectNo").val(isDeNull(projectNo) ? projectNo : "");
            $("#txtqty").val(qty);
            $("#txtlockQty").val(lockqty);
            $("#SelInvOrg").val(InvOrgID);
            $("#SelinventoryType").val(inventoryTypeID);
            $("#Selwarehouse").val(warehouseID);
            $("#txtremark").val(isDeNull(remark) ? remark : "");

        }



        //初始化物料下拉框
        function InitMaterialDDL() {
            leonhelper.callByAjax("/Material/GetMaterialLists", {
            }, function (data) {
                if (data && data.length > 0) {
                    data = null2str(data);
                    var str = '';//加载string
                    for (var i = 0; i < data.length; i++) {
                        str += ' <option class="materialItem" value="' + data[i].mDrawingNo + '" data-id="' + data[i].ID + '" >零件名称：' + data[i].mName;
                        if (data[i].mSpec != "") {
                            str += '    规格：' + data[i].mSpec;
                        }
                        str += ' </option>';
                    }
                    $("#hasMaterialInfo").empty(); //清空 datalist 可查询框
                    $("#hasMaterialInfo").append(str);
                }
            });
        }


        //初始化库存更新时间
        function InitLogTime() {
            leonhelper.callByAjax("/Material/GetInventoryLogTime", {
            }, function (data) {
                if (isDeNull(data)) {
                    data = null2str(data);
                    $("#LogTime").text("最后更新时间：" + data[0].logTimeText);
                }
            }, true);
        }


        function showExcel() {
            var Upload = document.getElementById("input-1a");
            var fileName = Upload.value;
            //返回String对象中子字符串最后出现的位置.
            var seat = fileName.lastIndexOf(".");
            //返回位于String对象中指定位置的子字符串并转换为小写.
            var extension = fileName.substring(seat).toLowerCase();
            var allowed = [".xls", ".xlsx"];
            for (var i = 0; i < allowed.length; i++) {
                if (!(allowed[i] != extension)) {
                    return true;
                }
            }
            Upload.value = "";
            Modal.alert("不支持" + extension + "格式，请重新选择!", 2);
            return false;
        }

        function UploadExcel() {
            //var index = layer.load(1); //添加laoding,0-2两种方式
            var UploadExcelFile = document.getElementById("input-1a").files[0];
            if (UploadExcelFile == undefined || UploadExcelFile.name == "") {
                Modal.alert("请选择要上传的Excel文件！");
                return;
            }


            layer.confirm('导入操作将会根据您所选择操作对库存进行更新，是否要导入及时库存信息？', {
                btn: ['清空所有导入', '保留库存导入', '取消'] //可以无限个按钮
                , shade: [0.8, '#393D49']
                , icon: 0                    // 0 ！， 1 √，2 ×，3 ？， 4 锁 ， 5 哭脸 ， 6 笑脸
                //, skin: 'layui-layer-molv' //'layui-layer-lans'//默认皮肤：demo-class layui-layer-lan  layui-layer-molv
                , yes: function (index, layero) {
                    //按钮【按钮一】的回调
                    //清空所有导入
                    ImportInventory(true);
                }, btn2: function (index, layero) {
                    //按钮【按钮二】的回调
                    //保留库存导入
                    ImportInventory(false);
                }, btn3: function (index, layero) {
                    //按钮【按钮三】的回调
                    layer.close(index);
                }, cancel: function (index, layero) {
                    //右上角关闭回调
                    layer.close(index);
                    //return false;//开启该代码可禁止点击该按钮关闭
                }
            });

            //leonhelper.simpleConfirm("导入操作将会先清空当前库存信息再进行更新，是否要导入及时库存信息？", function () {
            //    //加载中样式...
            //    var loading = layer.msg('正在导入中，请稍等...', {
            //        icon: 16,
            //        shade: [0.5, '#393D49'],//[0.5, '#000'],
            //        time: 0,
            //        success: function (layero, index) {
            //            //修正加载图标变形问题
            //            layero.find('.layui-layer-ico').css({
            //                'height': '34px',
            //                'width': '34px'
            //            });
            //        }
            //    });
            //    var FileName = UploadExcelFile.name;
            //    var formData = new FormData();
            //    formData.append("FileUploadExcel", UploadExcelFile);
            //    $.ajax({
            //        url: "/Material/UploadExcelFile",
            //        type: "post",
            //        data: formData,
            //        contentType: false,
            //        processData: false,
            //        success: function (data) {
            //            if (data.Result == true) {
            //                layer.close(loading);
            //                layerOpen(data.Message, '50px');
            //                //Modal.alert({
            //                //    text: data.Message, callback: function () {
            //                //        location.reload();
            //                //    }
            //                //});
            //            } else {

            //                //inexistenceMsg不存在
            //                var inexistence = "";
            //                if (isDeNull(data.inexistenceMsg)) {
            //                    for (var i = 0; i < data.inexistenceMsg.length; i++) {
            //                        inexistence += data.inexistenceMsg[i] + "<br>";
            //                    }
            //                }

            //                //repetitionMsg重复
            //                if (isDeNull(data.repetitionMsg)) {
            //                    var repetition = "";
            //                    for (var i = 0; i < data.repetitionMsg.length; i++) {
            //                        repetition += data.repetitionMsg[i] + "<br>";
            //                    }
            //                }

            //                if (isDeNull(data.inexistenceMsg) && isDeNull(data.repetitionMsg)) {
            //                    layer.close(loading);
            //                    layerOpen("<span style='color:red;'>上传失败<br>以下物料在物料基础信息中不存在，请检查！</span><br>" + inexistence + "<span style='color:red;'>以下物料在上传的Excel文件中重复，请检查！</span><br>" + repetition, '500px');
            //                } else if (isDeNull(data.inexistenceMsg)) {
            //                    layer.close(loading);
            //                    layerOpen("<span style='color:red;'>上传失败！<br>以下物料在物料基础信息中不存在，请检查！</span><br>" + inexistence, '500px');
            //                } else if (isDeNull(data.repetitionMsg)) {
            //                    layer.close(loading);
            //                    layerOpen("<span style='color:red;'>上传失败！<br>以下物料在上传的Excel文件中重复，请检查！</span><br>" + repetition, '500px');
            //                }
            //                else {
            //                    layer.close(loading);
            //                    layerOpen(data.Message, '50px');
            //                }
            //            }
            //        }, error: function (xhr) {
            //            alert(xhr.responseText);
            //        }
            //    });

            //}, function () { });


        }


        //通用上传方法 传入是否需要全删bool操作
        function ImportInventory(isDeleted) {
            var UploadExcelFile = document.getElementById("input-1a").files[0];

            //加载中样式...
            var loading = layer.msg('正在导入中，请稍等...', {
                icon: 16,
                shade: [0.5, '#393D49'],//[0.5, '#000'],
                time: 0,
                success: function (layero, index) {
                    //修正加载图标变形问题
                    layero.find('.layui-layer-ico').css({
                        'height': '34px',
                        'width': '34px'
                    });
                }
            });
            var FileName = UploadExcelFile.name;
            var formData = new FormData();
            formData.append("FileUploadExcel", UploadExcelFile);
            $.ajax({
                url: "/Material/UploadExcelFile?isDeleted=" + isDeleted,
                type: "post",
                data: formData,
                contentType: false,
                processData: false,
                success: function (data) {
                    if (data.Result == true) {
                        layer.close(loading);
                        layerOpen(data.Message, '50px');
                        //Modal.alert({
                        //    text: data.Message, callback: function () {
                        //        location.reload();
                        //    }
                        //});
                    } else {

                        //inexistenceMsg不存在
                        var inexistence = "";
                        if (isDeNull(data.inexistenceMsg)) {
                            for (var i = 0; i < data.inexistenceMsg.length; i++) {
                                inexistence += data.inexistenceMsg[i] + "<br>";
                            }
                        }

                        //repetitionMsg重复
                        if (isDeNull(data.repetitionMsg)) {
                            var repetition = "";
                            for (var i = 0; i < data.repetitionMsg.length; i++) {
                                repetition += data.repetitionMsg[i] + "<br>";
                            }
                        }

                        if (isDeNull(data.inexistenceMsg) && isDeNull(data.repetitionMsg)) {
                            layer.close(loading);
                            layerOpen("<span style='color:red;'>上传失败<br>以下物料在物料基础信息中不存在，请检查！</span><br>" + inexistence + "<span style='color:red;'>以下物料在上传的Excel文件中重复，请检查！</span><br>" + repetition, '500px');
                        } else if (isDeNull(data.inexistenceMsg)) {
                            layer.close(loading);
                            layerOpen("<span style='color:red;'>上传失败！<br>以下物料在物料基础信息中不存在，请检查！</span><br>" + inexistence, '500px');
                        } else if (isDeNull(data.repetitionMsg)) {
                            layer.close(loading);
                            layer.open({
                                content: "<span style='color:red;'>上传失败！<br>以下物料在上传的 " + FileName + " 文件中重复，请检查！</span><br>" + repetition,
                                btn: ['合并添加', '取消添加'],
                                area: '500px',
                                shade: [0.8, '#393D49'],
                                icon: 0,
                                shadeClose: false,
                                yes: function (index, layero) {

                                    var UploadExcelFile = document.getElementById("input-1a").files[0];

                                    //加载中样式...
                                    var loading = layer.msg('正在导入中，请稍等...', {
                                        icon: 16,
                                        shade: [0.5, '#393D49'],//[0.5, '#000'],
                                        time: 0,
                                        success: function (layero, index) {
                                            //修正加载图标变形问题
                                            layero.find('.layui-layer-ico').css({
                                                'height': '34px',
                                                'width': '34px'
                                            });
                                        }
                                    });
                                    var FileName = UploadExcelFile.name;
                                    var formData = new FormData();
                                    formData.append("FileUploadExcel", UploadExcelFile);
                                    $.ajax({
                                        url: "/Material/ImportUniqInventory",
                                        type: "post",
                                        data: formData,
                                        contentType: false,
                                        processData: false,
                                        success: function (data) {
                                            if (data.Result == true) {
                                                layer.close(loading);
                                                layerOpen(data.Message, '50px');
                                            } else {
                                                //inexistenceMsg不存在
                                                var inexistence = "";
                                                if (isDeNull(data.inexistenceMsg)) {
                                                    for (var i = 0; i < data.inexistenceMsg.length; i++) {
                                                        inexistence += data.inexistenceMsg[i] + "<br>";
                                                    }
                                                }
                                                //repetitionMsg重复
                                                if (isDeNull(data.repetitionMsg)) {
                                                    var repetition = "";
                                                    for (var i = 0; i < data.repetitionMsg.length; i++) {
                                                        repetition += data.repetitionMsg[i] + "<br>";
                                                    }
                                                }
                                                if (isDeNull(data.inexistenceMsg) && isDeNull(data.repetitionMsg)) {
                                                    layer.close(loading);
                                                    layerOpen("<span style='color:red;'>上传失败<br>以下物料在物料基础信息中不存在，请检查！</span><br>" + inexistence + "<span style='color:red;'>以下物料在上传的Excel文件中重复，请检查！</span><br>" + repetition, '500px');
                                                } else if (isDeNull(data.inexistenceMsg)) {
                                                    layer.close(loading);
                                                    layerOpen("<span style='color:red;'>上传失败！<br>以下物料在物料基础信息中不存在，请检查！</span><br>" + inexistence, '500px');
                                                }
                                                else {
                                                    layer.close(loading);
                                                    layerOpen(data.Message, '50px');
                                                }
                                            }
                                        }, error: function (xhr) {
                                            alert(xhr.responseText);
                                        }
                                    });
                                }, btn2: function (index, layero) {
                                    //按钮【按钮二】的回调
                                    layer.close(index); //如果设定了yes回调，需进行手工关闭
                                },
                                cancel: function (index, layero) {
                                    layer.close(index); //如果设定了yes回调，需进行手工关闭
                                }
                            });

                        }
                        else {
                            layer.close(loading);
                            layerOpen(data.Message, '50px');
                        }
                    }
                }, error: function (xhr) {
                    alert(xhr.responseText);
                }
            });
        }


        //判断是否是空 等于空false
        function isDeNull(value) {
            if (value == null || value == "" || value == "undefined" || value == undefined || value == "null" || value == "(null)" || value == 'NULL' || typeof (value) == 'undefined') {
                return false;
            } else {
                value = value + "";
                value = value.replace(/\s/g, "");
                if (value == "") {
                    return false;
                }
                return true;
            }
        }



        //验证是否为数字
        function isNumber(value) {
            var patrn = /^(-)?\d+(\.\d+)?$/;
            if (patrn.exec(value) == null || value == "") {
                return false
            } else {
                return true
            }
        }


        //将，分割的字符串装换为数组
        function ToArray(value) {
            if (isDeNull(value)) {
                var a = value.split(',');
                var b = [];
                for (var i in a) {
                    b.push(a[i]);
                }
                return b;
            }
            return null;
        }


        //Open提示
        function layerOpen(msg, areas) {
            layer.open({
                content: msg,
                btn: ['确认'],
                area: areas,
                shadeClose: false,
                yes: function (index, layero) {
                    layer.close(index); //如果设定了yes回调，需进行手工关闭
                    location.reload();
                },
                cancel: function (index, layero) {
                    layer.close(index); //如果设定了yes回调，需进行手工关闭
                    location.reload();
                }
            });
        }

        function mouseoverText(text) {
            if (isDeNull(text.innerHTML)) {
                $(text).tooltip({
                    trigger: 'hover',
                    animation: true,//在工具提示中应用CSS渐变过渡
                    html: true,
                    placement: 'left',//如何定位工具提示-自动|顶部|底部|左|右。
                    title: '<h6>' + text.innerHTML + '</h6>',
                    //template: '<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner define-tooltip-inner"></div></div>'
                    template: '<div class="tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>'
                }).tooltip('show');
            }
        }

    </script>
}

<div class="container-fluid">
    <div class="card card-primary card-outline">
        <div class="card-header">
            <div class="form-group form-inline">
                <div class="col-sm-5">
                    @if (RW.PMS.Common.Auth.SystemAuth.IsHasAuth(RW.PMS.Common.Auth.AuthType.Add, ViewBag.AuthVal))
                    {
                        <button id="btnAdd" type="button" class="btn btn-warning" data-toggle="modal" data-target="#divModal"><i class="fa fa-plus"> 新增</i></button>
                    }
                </div>
                <div class="col-sm-2">
                    <div id="LogTime" style="padding: 7px 0px 0px 0px; text-align: center; font-size: 14px; font-weight: bold; font-family:'Microsoft YaHei';"></div>
                </div>
                <div class="col-sm-3">
                    <input id="input-1a" type="file" class="file pull-right" data-show-preview="false" accept=".xls,.xlsx" onchange="showExcel()" />
                </div>
                <div class="col-sm-1">
                    <button type='button' class='btn btn-primary' onclick='UploadExcel()'><i class="fa fa-upload"></i> 上传</button>
                </div>
                <div class="col-sm-1">
                    <a class="btn btn-primary pull-right" href="/Material/DownloadWuliaoExcel"><i class="fa fa-download"></i> 下载模板 </a>
                </div>
            </div>

            <div class="shadow-none pl-3 pt-3 bg-light rounded">
                <div class="row">
                    @*<div class="col-sm-3">
                            <div class="form-auto">
                                <label class="form-label">物料:</label>
                                <select id="BMMC_SELECT" name="wlID" class="form-control selectpicker" data-live-search="true">
                                    <option class="materialItem" value="0">--全部--</option>
                                    @if (ViewBag.WlInfo != null)
                                    {
                                        foreach (RW.PMS.Model.BaseInfo.BaseMaterialModel item in ViewBag.WlInfo)
                                        {
                                            <option class="materialItem" value="@item.ID" @(item.ID.ToString() == Request["wlID"] ? "selected" : "" )>
                                                @item.mName - @item.mDrawingNo
                                                @if (!string.IsNullOrEmpty(item.mSpec))
                                                {
                                                    @(" - " + item.mSpec)
                                                }
                                            </option>
                                        }
                                    }
                                    <!-- 物料加载处 （零件名称—(唯一)零件号—规格） -->
                                </select>
                            </div>
                        </div>*@

                    <div class="col-sm-2">
                        <div class="form-auto" style="margin-left:5px;">
                            <label class="form-label">校验类型:</label>
                            <select id="isExists" name="isExists" class="form-control">
                                <option value="0">存在</option>
                                <option value="1">不存在</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-sm-2">
                        <div class="form-auto" style="margin-left:5px;">
                            <label class="form-label">库存类型:</label>
                            <select id="inventoryTypeID" name="inventoryTypeID" class="form-control">
                                <option value="0">--全部--</option>
                                <option value="1">普通</option>
                                @*<option value="2" @("2" == Request["inventoryTypeID"] ? "selected" : "" )>库存</option>*@
                            </select>
                        </div>
                    </div>

                    <div class="col-sm-2">
                        <div class="form-auto">
                            <label class="form-label">物料名称：</label>
                            <input id="wlName" name="wlName" type="text" class="form-control" placeholder="输入物料名称查找">
                        </div>
                    </div>

                    <div class="col-sm-2">
                        <div class="form-auto">
                            <label class="form-label">物料编号：</label>
                            <input id="wlCode" name="wlCode" type="text" class="form-control" placeholder="输入物料编号查找">
                        </div>
                    </div>

                    <div class="col-sm-2">
                        <div class="form-auto">
                            <label class="form-label">规格型号：</label>
                            <input id="wlModel" name="wlModel" type="text" class="form-control" placeholder="输入规格型号查找">
                        </div>
                    </div>

                    <div class="col-sm-1">
                        <div class="form-group">
                            <button id="BtnQuery" class="btn btn-primary">  <i class="fa fa-search"></i> 查询 </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card-body" style="padding-top:5px;">
            <div class="table">
                <!--表-->
                <table id="tbMainList" class="table table-striped table-hover myTable" @*data-height="589"*@></table>
            </div>
        </div>
    </div>
</div>




<!-- 回到顶部 -->
<a id="scrollUp" href="#top" style="position: fixed; z-index: -1; display: none;"></a>


<div class="modal fade" id="divModal" data-backdrop="static" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="width:750px;">
            <div class="modal-header">
                <h4 class="modal-title" id="hTit">新增库存信息</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <input id="hidID" type="hidden" />
                <div class="row">
                    <div class="col-sm-3">
                        <div class="form-auto">
                            <label class="form-label text-right"><span class="red">*</span>物料:</label>
                        </div>
                    </div>
                    <div class="col-sm-9">
                        <div class="form-group">
                            <input id="txtWlName" list="hasMaterialInfo" class="form-control" placeholder="可查询选择物料信息" autocomplete="off">
                            <datalist id="hasMaterialInfo"><!-- 物料加载处 （零件名称—(唯一)零件号—规格） --></datalist>
                            <input id="hidwlID" type="hidden" value="" />
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-3">
                        <div class="form-auto">
                            <label class="form-label text-right"><span class="red">&nbsp;</span>批号: </label>
                        </div>
                    </div>
                    <div class="col-sm-9">
                        <div class="form-group">
                            <input id="txtbatch" class="form-control" />
                        </div>
                    </div>
                </div>


                <div class="row">
                    <div class="col-sm-3">
                        <div class="form-auto">
                            <label class="form-label text-right"><span class="red">*</span>单位: </label>
                        </div>
                    </div>
                    <div class="col-sm-9">
                        <div class="form-group">
                            <input id="txtunit" class="form-control" />
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-3">
                        <div class="form-auto">
                            <label class="form-label text-right"><span class="red">&nbsp;</span>项目号: </label>
                        </div>
                    </div>
                    <div class="col-sm-9">
                        <div class="form-group">
                            <input id="txtprojectNo" class="form-control" />
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-3">
                        <div class="form-auto">
                            <label class="form-label text-right"><span class="red">*</span>数量: </label>
                        </div>
                    </div><div class="col-sm-9">
                        <div class="form-group">
                            <input id="txtqty" class="form-control" onkeyup="this.value = this.value.replace(/^[1-9]\d*\.\d{3}?$/,'')" />
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-3">
                        <div class="form-auto">
                            <label class="form-label text-right"><span class="red">&nbsp;</span>锁库数量: </label>
                        </div>
                    </div><div class="col-sm-9">
                        <div class="form-group">
                            <input id="txtlockQty" class="form-control" onkeyup="this.value = this.value.replace(/^[1-9]\d*\.\d{3}?$/,'')" readonly="readonly" />
                        </div>
                    </div>
                </div>

                @*<div class="row form-group">
                    <label class="control-label col-md-3" for="name"><span class="red">*</span>物料规格:</label>
                    <div class="col-md-8">
                    <select id="ddlwlmodelID" class="form-control">
                    <option value="0">--请选择--</option>
                    @if (ViewBag.WlcodeInfo != null)
                    {
                    foreach (RW.PMS.Model.BaseInfo.WuliaoModelModel item in ViewBag.WlcodeInfo)
                    {
                    <option value="@item.wlmodelID">@item.wlModels</option>
                    }
                    }
                    </select>
                    </div>
                    </div>*@

                <div class="row">
                    <div class="col-sm-3">
                        <div class="form-auto">
                            <label class="form-label text-right"><span class="red">*</span>库存组织:</label>
                        </div>
                    </div>  <div class="col-sm-9">
                        <div class="form-group">
                            <select id="SelInvOrg" class="form-control">
                                <option value="1">电气设备分公司</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-3">
                        <div class="form-auto">
                            <label class="form-label text-right"><span class="red">*</span>库存类型:</label>
                        </div>
                    </div>
                    <div class="col-sm-9">
                        <div class="form-group">
                            <select id="SelinventoryTypeID" class="form-control">
                                <option value="1">普通</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-3">
                        <div class="form-auto">
                            <label class="form-label text-right"><span class="red">*</span>仓库:</label>
                        </div>
                    </div>
                    <div class="col-sm-9">
                        <div class="form-group">
                            <select id="Selwarehouse" class="form-control">
                                <option value="1">DQ08段飞燕</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-3">
                        <div class="form-auto">
                            <label class="form-label text-right"><span class="red">&nbsp;</span>备注: </label>
                        </div>
                    </div>
                    <div class="col-sm-9">
                        <div class="form-group">
                            @*<input id="txtremark" class="form-control" />*@
                            <textarea rows="5" id="txtremark" class="form-control " style="resize:none;"></textarea>
                        </div>
                    </div>
                </div>


            </div>

            <div class="modal-footer">
                <button id="btnSave" class="btn btn-primary"><i class="fa fa-save"> 保存</i></button>
                <button class="btn btn-success" data-dismiss="modal" aria-label="Close"><i class="fa fa-share"> 返回</i></button>
            </div>

        </div>
    </div>
</div>
<style>
    /*定义类名为.thead-blue的样式*/
    .table .thead-blue th {
        color: #f3f0f0;
        background-color: #1a749a;
        text-align: center;
    }
</style>